<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Prague Lunch Bot</title>
    <script type="text/javascript" src="tailwindcss.js"></script>
    <style>
        .slide { display: none; }
        .active-slide { display: block; }
    </style>
</head>
<body class="bg-gradient-to-br from-[#00AEEF]/20 to-[#8A2DA5]/20 min-h-screen flex flex-col items-center font-sans text-gray-800 select-none">

<!-- Header with Progress Bar -->
<header class="bg-white/80 backdrop-blur-md shadow-md px-10 py-4 flex flex-col w-full">
    <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-5">
            <img src="sky_logo.png" alt="Prague Lunch Bot logo" class="w-30">
            <div>
                <h1 class="text-5xl font-extrabold text-[#0072CE]">Prague Lunch Bot</h1>
                <p class="text-2xl font-semibold text-gray-600" id="date"></p>
            </div>
        </div>
        <div class="text-right">
            <div id="slide-indicator" class="text-4xl font-bold text-[#0072CE]"></div>
        </div>
    </div>
    <div class="w-full h-2 bg-gray-300/40 rounded-full overflow-hidden">
        <div id="progress-bar" class="h-full bg-[#0072CE] rounded-full transition-all duration-100 ease-linear" style="width: 100%;"></div>
    </div>
</header>

<!-- Slide container -->
<main id="slides-container" class="w-full mt-10 px-6"></main>

<script>
    let currentSlide = 0;
    let slides = [];
    const slideDuration = 15; // seconds
    let progressInterval;

    function updateSlideIndicator() {
        document.getElementById('slide-indicator').textContent = `${currentSlide + 1} / ${slides.length}`;
    }

    function showSlide(index) {
        slides.forEach((slide, i) => {
            slide.classList.toggle("active-slide", i === index);
        });
        updateSlideIndicator();

        // Reset progress bar to 100% at start
        document.getElementById('progress-bar').style.width = '100%';

        // Clear previous interval
        if (progressInterval) clearInterval(progressInterval);

        let elapsed = 0;
        progressInterval = setInterval(() => {
            elapsed += 0.1;
            const percent = Math.max(0, ((slideDuration - elapsed) / slideDuration) * 100);
            document.getElementById('progress-bar').style.width = percent + '%';
            if (elapsed >= slideDuration) {
                // Before switching slide, set progress to 0%
                document.getElementById('progress-bar').style.width = '0%';
                currentSlide = (currentSlide + 1) % slides.length;
                showSlide(currentSlide);
            }
        }, 100);
    }

    async function loadMenus() {
        const res = await fetch(`menus.json?v={{HASH}}`);
        const data = await res.json();

        document.getElementById("date").textContent = new Date(data.date).toLocaleDateString("en-GB", {
            weekday: "long",
            day: "2-digit",
            month: "2-digit",
            year: "numeric"
        });

        const container = document.getElementById("slides-container");

        data.menus.en.forEach(menu => {
            const slide = document.createElement("div");
            slide.className = "slide bg-white rounded-3xl shadow-xl p-10 border border-[#00AEEF]/30 h-[75vh] overflow-hidden flex flex-col";

            const sortedItems = menu.items.sort((a, b) => {
                const rank = i => i.isSoup ? 0 : i.isVegetarian ? 1 : 2;
                return rank(a) - rank(b);
            });

            let itemHtml = sortedItems.map(i => `
                <li class="border-b border-gray-200 pb-4 break-inside-avoid">
                    <div class="flex justify-between items-center">
                        <span class="flex items-center gap-4 font-medium text-xl">
                            ${i.isSoup ? '<span class="text-[#00AEEF] text-3xl">ü•£</span>' : ''}
                            ${i.isVegetarian ? '<span class="text-green-600 text-3xl">üåø</span>' : ''}
                            <span>${i.name}</span>
                        </span>
                        <span class="text-gray-700 text-xl">${i.price ? `${i.price}&nbsp;Kƒç` : ''}</span>
                    </div>
                    ${i.description ? `<p class="text-gray-500 mt-2 ml-12 text-lg">${i.description}</p>` : ''}
                </li>
            `).join('');

            slide.innerHTML = `
                <h2 class="text-5xl font-bold mb-6 text-[#0072CE] text-center">${menu.name}</h2>
                <ul class="columns-1 sm:columns-2 gap-12 text-xl break-words">
                    ${itemHtml}
                </ul>
            `;

            container.appendChild(slide);
        });

        slides = Array.from(document.getElementsByClassName("slide"));

        if (slides.length > 0) {
            showSlide(0);
        }
    }

    loadMenus();
</script>

</body>
</html>
